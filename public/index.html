async function checkStatus() {
    if (isChecking) return;
    
    isChecking = true;
    const checkBtn = document.getElementById('check-btn');
    const resultContainer = document.getElementById('result-container');
    
    checkBtn.disabled = true;
    checkBtn.innerHTML = 'üîÑ Checking...';
    
    // Show loading state
    resultContainer.innerHTML = `
        <div class="status-card status-loading">
            <div class="loading-spinner"></div>
            <div class="status-title">Checking Status...</div>
            <div class="status-message">Connecting to Lavalink server...</div>
        </div>
    `;
    
    try {
        const response = await fetch('/api/check');
        const data = await response.json();
        
        lastCheckTime = new Date();
        updateTimestamp();
        
        let statusHtml = '';
        
        if (data.status === 'online') {
            // ... existing online code ...
        } else if (data.status === 'error') {
            statusHtml = `
                <div class="status-card status-error">
                    <div class="status-icon">‚ö†Ô∏è</div>
                    <div class="status-title">Server Error (${data.message})</div>
                    <div class="status-message">${data.details || data.message}</div>
                    ${data.data ? `
                    <div class="status-details">
                        <div class="details-title" onclick="toggleDetails()">
                            <span>üìã Server Response</span>
                            <span id="details-arrow">‚ñº</span>
                        </div>
                        <div class="details-content" id="details-content">
                            <div class="lavalink-data">
                                ${JSON.stringify(data.data, null, 2)}
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        } else {
            statusHtml = `
                <div class="status-card status-offline">
                    <div class="status-icon">‚ùå</div>
                    <div class="status-title">Connection Failed</div>
                    <div class="status-message">${data.message}</div>
                    <div class="status-details">
                        <div class="details-title" onclick="toggleDetails()">
                            <span>üîç Error Details</span>
                            <span id="details-arrow">‚ñº</span>
                        </div>
                        <div class="details-content" id="details-content">
                            <p><strong>Error:</strong> ${data.details || 'No details available'}</p>
                            ${data.errorCode ? `<p><strong>Error Code:</strong> ${data.errorCode}</p>` : ''}
                            <p><strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                            <hr style="margin: 15px 0; border-color: #e2e8f0;">
                            <p><strong>Troubleshooting steps:</strong></p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Check if Lavalink server is running</li>
                                <li>Verify IP address and port are correct</li>
                                <li>Check firewall settings</li>
                                <li>Try connecting manually: http://${LAVALINK_IP}:${LAVALINK_PORT}/v4/info</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        resultContainer.innerHTML = statusHtml;
        
    } catch (error) {
        resultContainer.innerHTML = `
            <div class="status-card status-offline">
                <div class="status-icon">üí•</div>
                <div class="status-title">Network Error</div>
                <div class="status-message">${error.message}</div>
                <p style="margin-top: 10px; color: #64748b;">
                    Unable to reach the monitoring API. Check your network connection.
                </p>
            </div>
        `;
    } finally {
        isChecking = false;
        checkBtn.disabled = false;
        checkBtn.innerHTML = 'üîç Check Status Now';
    }
}
